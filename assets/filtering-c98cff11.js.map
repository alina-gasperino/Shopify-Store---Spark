{"version":3,"file":"filtering-c98cff11.js","sources":["../../src/scripts/lib/filters/filtering.js"],"sourcesContent":["import { qsa } from '@fluorescent/dom';\r\n\r\nimport { emit } from '@/glow/events';\r\n\r\nconst filtering = container => {\r\n  const forms = qsa('[data-filter-form]', container);\r\n  let formData, searchParams;\r\n  setParams();\r\n\r\n  function setParams(form) {\r\n    form = form || forms[0];\r\n    formData = new FormData(form);\r\n    searchParams = new URLSearchParams(formData).toString();\r\n  }\r\n\r\n  /**\r\n   * Takes the updated form element and updates all other forms with the updated values\r\n   * @param {*} target\r\n   */\r\n  function syncForms(target) {\r\n    if (!target) return;\r\n\r\n    const targetInputs = qsa('[data-filter-item]', target);\r\n\r\n    targetInputs.forEach(targetInput => {\r\n      if (targetInput.type === 'checkbox' || targetInput.type === 'radio') {\r\n        const items = qsa(\r\n          `input[name='${targetInput.name}'][value='${targetInput.value}']`\r\n        );\r\n        items.forEach(input => {\r\n          input.checked = targetInput.checked;\r\n        });\r\n      } else {\r\n        const items = qsa(`input[name='${targetInput.name}']`);\r\n        items.forEach(input => {\r\n          input.value = targetInput.value;\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * When filters are removed, set the checked attribute to false\r\n   * for all filter inputs for that filter.\r\n   * Can accept multiple filters\r\n   * @param {Array} targets Array of inputs\r\n   */\r\n  function uncheckFilters(targets) {\r\n    if (!targets) return;\r\n\r\n    let selector;\r\n\r\n    targets.forEach(target => {\r\n      selector = !selector ? '' : `, ${selector}`;\r\n      const { name, value } = target.dataset;\r\n      selector = `input[name='${name}'][value='${value}']${selector}`;\r\n    });\r\n\r\n    const inputs = qsa(selector, container);\r\n\r\n    inputs.forEach(input => {\r\n      input.checked = false;\r\n    });\r\n  }\r\n\r\n  function clearRangeInputs() {\r\n    const rangeInputs = qsa('[data-range-input]', container);\r\n    rangeInputs.forEach(input => {\r\n      input.value = '';\r\n    });\r\n  }\r\n\r\n  function resetForms() {\r\n    forms.forEach(form => {\r\n      form.reset();\r\n    });\r\n  }\r\n\r\n  return {\r\n    getState() {\r\n      return {\r\n        url: searchParams,\r\n      };\r\n    },\r\n\r\n    filtersUpdated(target, cb) {\r\n      syncForms(target);\r\n      setParams(target);\r\n      emit('filters:updated');\r\n      return cb(this.getState());\r\n    },\r\n\r\n    removeFilters(target, cb) {\r\n      uncheckFilters(target);\r\n      setParams();\r\n      emit('filters:filter-removed');\r\n      return cb(this.getState());\r\n    },\r\n\r\n    removeRange(cb) {\r\n      clearRangeInputs();\r\n      setParams();\r\n      emit('filters:range-removed');\r\n      return cb(this.getState());\r\n    },\r\n\r\n    clearAll(cb) {\r\n      searchParams = '';\r\n      resetForms();\r\n\r\n      return cb(this.getState());\r\n    },\r\n  };\r\n};\r\n\r\nexport default filtering;\r\n"],"names":["filtering","container","forms","qsa","formData","searchParams","setParams","form","FormData","URLSearchParams","toString","syncForms","target","targetInputs","forEach","targetInput","type","items","name","value","input","checked","uncheckFilters","targets","selector","dataset","inputs","clearRangeInputs","rangeInputs","resetForms","reset","getState","url","filtersUpdated","cb","emit","removeFilters","removeRange","clearAll"],"mappings":";;MAIMA,SAAS,GAAGC,SAAS,IAAI;AAC7B,QAAMC,KAAK,GAAGC,CAAG,CAAC,oBAAD,EAAuBF,SAAvB,CAAjB;AACA,MAAIG,QAAJ,EAAcC,YAAd;AACAC,EAAAA,SAAS;;AAET,WAASA,SAAT,CAAmBC,IAAnB,EAAyB;AACvBA,IAAAA,IAAI,GAAGA,IAAI,IAAIL,KAAK,CAAC,CAAD,CAApB;AACAE,IAAAA,QAAQ,GAAG,IAAII,QAAJ,CAAaD,IAAb,CAAX;AACAF,IAAAA,YAAY,GAAG,IAAII,eAAJ,CAAoBL,QAApB,EAA8BM,QAA9B,EAAf;AACD;AAED;AACF;AACA;AACA;;;AACE,WAASC,SAAT,CAAmBC,MAAnB,EAA2B;AACzB,QAAI,CAACA,MAAL,EAAa;AAEb,UAAMC,YAAY,GAAGV,CAAG,CAAC,oBAAD,EAAuBS,MAAvB,CAAxB;AAEAC,IAAAA,YAAY,CAACC,OAAb,CAAqBC,WAAW,IAAI;AAClC,UAAIA,WAAW,CAACC,IAAZ,KAAqB,UAArB,IAAmCD,WAAW,CAACC,IAAZ,KAAqB,OAA5D,EAAqE;AACnE,cAAMC,KAAK,GAAGd,CAAG,CACd,eAAcY,WAAW,CAACG,IAAK,aAAYH,WAAW,CAACI,KAAM,IAD/C,CAAjB;AAGAF,QAAAA,KAAK,CAACH,OAAN,CAAcM,KAAK,IAAI;AACrBA,UAAAA,KAAK,CAACC,OAAN,GAAgBN,WAAW,CAACM,OAA5B;AACD,SAFD;AAGD,OAPD,MAOO;AACL,cAAMJ,KAAK,GAAGd,CAAG,CAAE,eAAcY,WAAW,CAACG,IAAK,IAAjC,CAAjB;AACAD,QAAAA,KAAK,CAACH,OAAN,CAAcM,KAAK,IAAI;AACrBA,UAAAA,KAAK,CAACD,KAAN,GAAcJ,WAAW,CAACI,KAA1B;AACD,SAFD;AAGD;AACF,KAdD;AAeD;AAED;AACF;AACA;AACA;AACA;AACA;;;AACE,WAASG,cAAT,CAAwBC,OAAxB,EAAiC;AAC/B,QAAI,CAACA,OAAL,EAAc;AAEd,QAAIC,QAAJ;AAEAD,IAAAA,OAAO,CAACT,OAAR,CAAgBF,MAAM,IAAI;AACxBY,MAAAA,QAAQ,GAAG,CAACA,QAAD,GAAY,EAAZ,GAAkB,KAAIA,QAAS,EAA1C;AACA,YAAM;AAAEN,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAkBP,MAAM,CAACa,OAA/B;AACAD,MAAAA,QAAQ,GAAI,eAAcN,IAAK,aAAYC,KAAM,KAAIK,QAAS,EAA9D;AACD,KAJD;AAMA,UAAME,MAAM,GAAGvB,CAAG,CAACqB,QAAD,EAAWvB,SAAX,CAAlB;AAEAyB,IAAAA,MAAM,CAACZ,OAAP,CAAeM,KAAK,IAAI;AACtBA,MAAAA,KAAK,CAACC,OAAN,GAAgB,KAAhB;AACD,KAFD;AAGD;;AAED,WAASM,gBAAT,GAA4B;AAC1B,UAAMC,WAAW,GAAGzB,CAAG,CAAC,oBAAD,EAAuBF,SAAvB,CAAvB;AACA2B,IAAAA,WAAW,CAACd,OAAZ,CAAoBM,KAAK,IAAI;AAC3BA,MAAAA,KAAK,CAACD,KAAN,GAAc,EAAd;AACD,KAFD;AAGD;;AAED,WAASU,UAAT,GAAsB;AACpB3B,IAAAA,KAAK,CAACY,OAAN,CAAcP,IAAI,IAAI;AACpBA,MAAAA,IAAI,CAACuB,KAAL;AACD,KAFD;AAGD;;AAED,SAAO;AACLC,IAAAA,QAAQ,GAAG;AACT,aAAO;AACLC,QAAAA,GAAG,EAAE3B;AADA,OAAP;AAGD,KALI;;AAOL4B,IAAAA,cAAc,CAACrB,MAAD,EAASsB,EAAT,EAAa;AACzBvB,MAAAA,SAAS,CAACC,MAAD,CAAT;AACAN,MAAAA,SAAS,CAACM,MAAD,CAAT;AACAuB,MAAAA,CAAI,CAAC,iBAAD,CAAJ;AACA,aAAOD,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;AACD,KAZI;;AAcLK,IAAAA,aAAa,CAACxB,MAAD,EAASsB,EAAT,EAAa;AACxBZ,MAAAA,cAAc,CAACV,MAAD,CAAd;AACAN,MAAAA,SAAS;AACT6B,MAAAA,CAAI,CAAC,wBAAD,CAAJ;AACA,aAAOD,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;AACD,KAnBI;;AAqBLM,IAAAA,WAAW,CAACH,EAAD,EAAK;AACdP,MAAAA,gBAAgB;AAChBrB,MAAAA,SAAS;AACT6B,MAAAA,CAAI,CAAC,uBAAD,CAAJ;AACA,aAAOD,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;AACD,KA1BI;;AA4BLO,IAAAA,QAAQ,CAACJ,EAAD,EAAK;AACX7B,MAAAA,YAAY,GAAG,EAAf;AACAwB,MAAAA,UAAU;AAEV,aAAOK,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;AACD;;AAjCI,GAAP;AAmCD;;;;"}